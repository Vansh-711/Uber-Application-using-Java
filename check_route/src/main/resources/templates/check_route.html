<!DOCTYPE html>
<html>
<head>
    <title>Ola Maps Polyline</title>
    <script src="https://www.unpkg.com/olamaps-web-sdk@latest/dist/olamaps-web-sdk.umd.js"></script>

    <style>
        /* Removes default margin from the page */
        body { margin: 0; padding: 0; }
        /* Makes the map container fill the entire screen */
        #map { height: 100vh; width: 100%; }
    </style>
</head>
<body>

<div id="map"></div>

<script src = "/direction_coordinates.js"></script>

<script>
    // 1. Initialize Ola Maps with your API Key
    const olaMaps = new OlaMaps({
        // IMPORTANT: Replace this with your actual Ola Maps API key
        apiKey: "Uer9nnXtI726LogTusu4W3ebgiCXGyumxqwCaXhn"
    });

    // 2. Create the map instance
    const myMap = olaMaps.init({
        style: "https://api.olamaps.io/tiles/vector/v1/styles/default-light-standard/style.json",
        container: 'map',
        // Centered coordinates to view the entire line
        center: [76.533575, 21.049776],
        // Adjusted zoom level to fit the line
        zoom: 11
    });

    // 3. Wait for the map to load before adding the line
    myMap.on('load', () => {
        // Adds the GeoJSON data source for the line
        myMap.addSource('route', {
            'type': 'geojson',
            'data': {
                'type': 'Feature',
                'properties': {},
                'geometry': {
                    'type': 'LineString',
                    // Your new coordinates are here
                    'coordinates': routeCoordinates
                }
            }
        });

        // Adds the layer to style and display the line on the map
        myMap.addLayer({
            'id': 'route',
            'type': 'line',
            'source': 'route', // Links to the 'route' source above
            'layout': {
                'line-join': 'round',
                'line-cap': 'round'
            },
            'paint': {
                'line-color': '#f00', // Line color (red)
                'line-width': 4     // Line width in pixels
            }
        });

        // 4. Adding markers of start location and text message

        const startCoordinate = routeCoordinates[0];
        const endCoordinate = routeCoordinates[routeCoordinates.length - 1];

        // popup for start
        const startPopup = olaMaps
            .addPopup({
                offset: [0, -15],
                anchor: 'bottom'
            })
            .setText('Start Location');

        // popup for end
        const endPopup = olaMaps
            .addPopup({
                offset: [0, -15],
                anchor: 'bottom'
            })
            .setText('End Location');

        //start marker
        const startMarker = olaMaps
            .addMarker({
                offset: [0, -10],
                anchor: 'bottom',
                color: 'green'
            })
            .setLngLat(startCoordinate)
            .setPopup(startPopup)
            .addTo(myMap);

        // end marker
        const endMarker = olaMaps
            .addMarker({
                offset: [0, -10],
                anchor: 'bottom',
                color: 'red'
            })
            .setLngLat(endCoordinate)
            .setPopup(endPopup)
            .addTo(myMap);

        // click event listeners to show text when markers are clicked
        startMarker.on('click', () => {
            startPopup.addTo(myMap);
        });

        endMarker.on('click', () => {
            endPopup.addTo(myMap);
        });
    });
</script>

</body>
</html>